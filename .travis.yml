language: go
go:
  - tip
env:
  - env GOOS=linux GOARCH=amd64 BUILD_NAME=oauth2-router.linux.amd64
  - env GOOS=darwin GOARCH=amd64 BUILD_NAME=oauth2-router.linux.amd64
  - env GOOS=windows GOARCH=386 BUILD_NAME=oauth2-router.windows.amd64.exe
script:
  - 'go test ./...'
  - go build -o $BUILD_NAME

deploy:
  provider: releases
  skip_cleanup: true
  file:
  - oauth2-router.windows.amd64.exe
  - oauth2-router.darwin.amd64
  - oauth2-router.linux.amd64
  on:
    branch: master
    tags: true
    condition: $LATEST = true
